<!doctype html>
<html lang="en">
  
  {% include head.html.liquid -%}
  
  <body>
    <div class="row">
      <div class="col1">
        
        {% include header.html.liquid -%}
        
        <div class="page page-post">
          
          <div class="pretitle">
            {% unless jekyll.environment == 'production' %}
              <span class="crud">
                <a
                  href="{{ site.adminUrl }}/edit/{{ site.gitBranch | escape }}/{{ page.path | escape }}"
                  class="hover-underline"
                  target="_blank"
                >
                  <span class="material-icons">edit_note</span>
                </a>
              </span>
            {% endunless %}
            {% assign collection = site.collections | where: 'label', page.collection | first %}
            {% if page.published == false %}
              <span class="material-icons">lock</span>
            {% endif %}
            <a href="{{ site.baseurl }}{{ collection.url }}">
              <code class="language-plaintext">{{ collection.name }}</code>
            </a>
            {% for category in page.categories -%}
              <a
                href="{{ site.baseurl }}{{ collection.url }}?category={{ category }}"
                class="category-link hover-underline"
              >
                {{- category -}}
              </a>
            {%- endfor %}
          </div>
          <h1 class="title" id="{{ page.title }}">{{ page.title }}</h1>
          <div class="subtitle">
            {% if page.date -%}
              <span class="material-icons">calendar_month</span>
              <span>
                {{ page.date | date: '%Y-%m-%d' -}}
              </span>
              {%- if site.extCount %}
                <span>浏览量</span>
                <span id="busuanzi_value_page_pv"></span>
              {% endif %}
            {% endif %}
          </div>
          
          <div class="post"><h2 id="overview">Overview</h2>

<p>Sample Docker-Compose configurations. Tested on <code class="language-plaintext highlighter-rouge">Docker v 20.10.8</code> and <code class="language-plaintext highlighter-rouge">Docker-Compose v 1.29.1</code>.</p>

<h2 id="forward-aws-credentials">Forward AWS Credentials</h2>

<p>We can forward AWS credentials from host to the container, useful for VSCode devcontainers.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s1">'3'</span>

services:

  devcontainer:
    container_name: ear-devcontainer
    init: <span class="nb">true
    </span>build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    env_file: .env
    volumes:
      - ..:/workspace:cached <span class="c"># VSCode workspace</span>
      - ~/.aws:/home/node/.aws:cached <span class="c"># AWS credentials</span>
      - /var/run/docker.sock:/var/run/docker-host.sock <span class="c"># host's Docker daemon</span>
    networks:
      - express_api_ref

networks:
  express_api_ref:
    name: express_api_ref
</code></pre></div></div>

<h2 id="mysql-57">MySQL 5.7</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s1">'3'</span>

services:

  db:
    container_name: tf-api-db
    image: mysql:5.7
    <span class="c"># Default MySQL 5.7 character set and collation is latin1, but utf8 is recommended by MySQL themself.</span>
    <span class="c"># https://dev.mysql.com/doc/mysql-installation-excerpt/5.7/en/docker-mysql-more-topics.html</span>
    <span class="c"># https://stackoverflow.com/questions/2708958/differences-between-utf8-and-latin1</span>
    <span class="c"># https://stackoverflow.com/questions/30074492/what-is-the-difference-between-utf8mb4-and-utf8-charsets-in-mysql</span>
    <span class="nb">command</span>: mysqld <span class="nt">--default-authentication-plugin</span><span class="o">=</span>mysql_native_password <span class="nt">--character-set-server</span><span class="o">=</span>utf8mb4 <span class="nt">--collation-server</span><span class="o">=</span>utf8mb4_unicode_ci
    env_file: .env
    environment:
      MYSQL_RANDOM_ROOT_PASSWORD: 1
      MYSQL_DATABASE: <span class="nv">$TF_API_DB_NAME</span>
      MYSQL_USER: <span class="nv">$TF_API_DB_USER</span>
      MYSQL_PASSWORD: <span class="nv">$TF_API_DB_PASSWORD</span>
      MYSQL_TCP_PORT: <span class="nv">$TF_API_DB_PORT</span>
    ports:
      - <span class="s2">"</span><span class="nv">$TF_API_DB_PORT</span><span class="s2">:</span><span class="nv">$TF_API_DB_PORT</span><span class="s2">"</span>
</code></pre></div></div>
</div>
          
          {% if site.extAdsense -%}
            <div class="adsense" style="overflow: hidden">
              {% include ext-adsense.html.liquid -%}
            </div>
          {% endif %}
          
        </div>
        
        {% include footer.html.liquid -%}
        
      </div>
      <div class="sidebar col2">
        <div class="toc-wrapper">
          <div class="toc-header">Contents</div>
          <nav id="toc"></nav>
        </div>
      </div>
    </div>
    
    {% include script.html.liquid -%}
    
  </body>
</html>
